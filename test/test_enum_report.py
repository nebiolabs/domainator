from pathlib import Path
import tempfile
from glob import glob
from helpers import compare_files
import pytest

from domainator import enum_report

def test_enum_report_1(shared_datadir):
    
    with tempfile.TemporaryDirectory() as output_dir:
        #output_dir = "test_out"
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "pDONR201_multi_genemark_domainator.gb"), "-o", out, "--domains"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 5
            assert lines[0].strip().split("\t") == ["contig","domains"]
            for l_num in range(1,len(lines)):
                l = lines[l_num]
                l = l.strip().split("\t")
                assert f"pDONR201_{l_num}" == l[0]
                assert l[1] == "2-oxoacid_dh; APH; CAT; CcdA; CcdB; Condensation; TCAD9"
                assert len(l) == 2

def test_enum_report_2(shared_datadir):
    
    with tempfile.TemporaryDirectory() as output_dir:
        #output_dir = "test_out"
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "pDONR201_multi_genemark_domainator.gb"), "-o", out, "--domains", "--sequence", "--length", "--topology" ])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 5
            assert lines[0].strip().split("\t") == ["contig","domains","sequence","length","topology"]
            for l_num in range(1,len(lines)):
                l = lines[l_num]
                l = l.strip().split("\t")
                assert f"pDONR201_{l_num}" == l[0]
                assert l[1] == "2-oxoacid_dh; APH; CAT; CcdA; CcdB; Condensation; TCAD9"
                assert l[2] == "CTTTCCTGCGTTATCCCCTGATTCTGTGGATAACCGTATTACCGCTAGCCAGGAAGAGTTTGTAGAAACGCAAAAAGGCCATCCGTCAGGATGGCCTTCTGCTTAGTTTGATGCCTGGCAGTTTATGGCGGGCGTCCTGCCCGCCACCCTCCGGGCCGTTGCTTCACAACGTTCAAATCCGCTCCCGGCGGATTTGTCCTACTCAGGAGAGCGTTCACCGACAAACAACAGATAAAACGAAAGGCCCAGTCTTCCGACTGAGCCTTTCGTTTTATTTGATGCCTGGCAGTTCCCTACTCTCGCGTTAACGCTAGCATGGATCTCGGGCCCCAAATAATGATTTTATTTTGACTGATAGTGACCTGTTCGTTGCAACAAATTGATGAGCAATGCTTTTTTATAATGCCAAGTTTGTACAAAAAAGCAGAACGAGAAACGTAAAATGATATAAATATCAATATATTAAATTAGATTTTGCATAAAAAACAGACTACATAATACTGTAAAACACAACATATCCAGTCACTATGAATCAACTACTTAGATGGTATTAGTGACCTGTAGTCGACCGACAGCCTTCCAAATGTTCTTCGGGTGATGCTGCCAACTTAGTCGACCGACAGCCTTCCAAATGTTCTTCTCAAACGGAATCGTCGTATCCAGCCTACTCGCTATTGTCCTCAATGCCGTATTAAATCATAAAAAGAAATAAGAAAAAGAGGTGCGAGCCTCTTTTTTGTGTGACAAAATAAAAACATCTACCTATTCATATACGCTAGTGTCATAGTCCTGAAAATCATCTGCATCAAGAACAATTTCACAACTCTTATACTTTTCTCTTACAAGTCGTTCGGCTTCATCTGGATTTTCAGCCTCTATACTTACTAAACGTGATAAAGTTTCTGTAATTTCTACTGTATCGACCTGCAGACTGGCTGTGTATAAGGGAGCCTGACATTTATATTCCCCAGAACATCAGGTTAATGGCGTTTTTGATGTCATTTTCGCGGTGGCTGAGATCAGCCACTTCTTCCCCGATAACGGAGACCGGCACACTGGCCATATCGGTGGTCATCATGCGCCAGCTTTCATCCCCGATATGCACCACCGGGTAAAGTTCACGGGAGACTTTATCTGACAGCAGACGTGCACTGGCCAGGGGGATCACCATCCGTCGCCCGGGCGTGTCAATAATATCACTCTGTACATCCACAAACAGACGATAACGGCTCTCTCTTTTATAGGTGTAAACCTTAAACTGCATTTCACCAGTCCCTGTTCTCGTCAGCAAAAGAGCCGTTCATTTCAATAAACCGGGCGACCTCAGCCATCCCTTCCTGATTTTCCGCTTTCCAGCGTTCGGCACGCAGACGACGGGCTTCATTCTGCATGGTTGTGCTTACCAGACCGGAGATATTGACATCATATATGCCTTGAGCAACTGATAGCTGTCGCTGTCAACTGTCACTGTAATACGCTGCTTCATAGCACACCTCTTTTTGACATACTTCGGGTATACATATCAGTATATATTCTTATACCGCAAAAATCAGCGCGCAAATACGCATACTGTTATCTGGCTTTTAGTAAGCCGGATCCACGCGATTACGCCCCGCCCTGCCACTCATCGCAGTACTGTTGTAATTCATTAAGCATTCTGCCGACATGGAAGCCATCACAGACGGCATGATGAACCTGAATCGCCAGCGGCATCAGCACCTTGTCGCCTTGCGTATAATATTTGCCCATGGTGAAAACGGGGGCGAAGAAGTTGTCCATATTGGCCACGTTTAAATCAAAACTGGTGAAACTCACCCAGGGATTGGCTGAGACGAAAAACATATTCTCAATAAACCCTTTAGGGAAATAGGCCAGGTTTTCACCGTAACACGCCACATCTTGCGAATATATGTGTAGAAACTGCCGGAAATCGTCGTGGTATTCACTCCAGAGCGATGAAAACGTTTCAGTTTGCTCATGGAAAACGGTGTAACAAGGGTGAACACTATCCCATATCACCAGCTCACCGTCTTTCATTGCCATACGGAATTCCGGATGAGCATTCATCAGGCGGGCAAGAATGTGAATAAAGGCCGGATAAAACTTGTGCTTATTTTTCTTTACGGTCTTTAAAAAGGCCGTAATATCCAGCTGAACGGTCTGGTTATAGGTACATTGAGCAACTGACTGAAATGCCTCAAAATGTTCTTTACGATGCCATTGGGATATATCAACGGTGGTATATCCAGTGATTTTTTTCTCCATTTTAGCTTCCTTAGCTCCTGAAAATCTCGATAACTCAAAAAATACGCCCGGTAGTGATCTTATTTCATTATGGTGAAAGTTGGAACCTCTTACGTGCCGATCAACGTCTCATTTTCGCCAAAAGTTGGCCCAGGGCTTCCCGGTATCAACAGGGACACCAGGATTTATTTATTCTGCGAAGTGATCTTCCGTCACAGGTATTTATTCGGCGCAAAGTGCGTCGGGTGATGCTGCCAACTTAGTCGACTACAGGTCACTAATACCATCTAAGTAGTTGATTCATAGTGACTGGATATGTTGTGTTTTACAGTATTATGTAGTCTGTTTTTTATGCAAAATCTAATTTAATATATTGATATTTATATCATTTTACGTTTCTCGTTCAGCTTTCTTGTACAAAGTGGGCATTATAAGAAAGCATTGCTTATCAATTTGTTGCAACGAACAGGTCACTATCAGTCAAAATAAAATCATTATTTGCCATCCAGCTGCAGCTCTGGCCCGTGTCTCAAAATCTCTGATGTTACATTGCACAAGATAAAAATATATCATCATGAACAATAAAACTGTCTGCTTACATAAACAGTAATACAAGGGGTGTTATGAGCCATATTCAACGGGAAACGTCGAGGCCGCGATTAAATTCCAACATGGATGCTGATTTATATGGGTATAAATGGGCTCGCGATAATGTCGGGCAATCAGGTGCGACAATCTATCGCTTGTATGGGAAGCCCGATGCGCCAGAGTTGTTTCTGAAACATGGCAAAGGTAGCGTTGCCAATGATGTTACAGATGAGATGGTCAGACTAAACTGGCTGACGGAATTTATGCCTCTTCCGACCATCAAGCATTTTATCCGTACTCCTGATGATGCATGGTTACTCACCACTGCGATCCCCGGAAAAACAGCATTCCAGGTATTAGAAGAATATCCTGATTCAGGTGAAAATATTGTTGATGCGCTGGCAGTGTTCCTGCGCCGGTTGCATTCGATTCCTGTTTGTAATTGTCCTTTTAACAGCGATCGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAGTTTCATTTGATGCTCGATGAGTTTTTCTAATCAGAATTGGTTAATTGGTTGTAACACTGGCAGAGCATTACGCTGACTTGACGGGACGGCGCAAGCTCATGACCAAAATCCCTTAACGTGAGTTTTCGTTCCACTGAGCGTCAGACCCCGTAGAAAAGATCAAAGGATCTTCTTGAGATCCTTTTTTTCTGCGCGTAATCTGCTGCTTGCAAACAAAAAAACCACCGCTACCAGCGGTGGTTTGTTTGCCGGATCAAGAGCTACCAACTCTTTTTCCGAAGGTAACTGGCTTCAGCAGAGCGCAGATACCAAATACTGTCCTTCTAGTGTAGCCGTAGTTAGGCCACCACTTCAAGAACTCTGTAGCACCGCCTACATACCTCGCTCTGCTAATCCTGTTACCAGTGGCTGCTGCCAGTGGCGATAAGTCGTGTCTTACCGGGTTGGACTCAAGACGATAGTTACCGGATAAGGCGCAGCGGTCGGGCTGAACGGGGGGTTCGTGCACACAGCCCAGCTTGGAGCGAACGACCTACACCGAACTGAGATACCTACAGCGTGAGCTATGAGAAAGCGCCACGCTTCCCGAAGGGAGAAAGGCGGACAGGTATCCGGTAAGCGGCAGGGTCGGAACAGGAGAGCGCACGAGGGAGCTTCCAGGGGGAAACGCCTGGTATCTTTATAGTCCTGTCGGGTTTCGCCACCTCTGACTTGAGCGTCGATTTTTGTGATGCTCGTCAGGGGGGCGGAGCCTATGGAAAAACGCCAGCAACGCGGCCTTTTTACGGTTCCTGGCCTTTTGCTGGCCTTTTGCTCACATGTT"
                assert l[3] == "4470"
                assert l[4] == "linear"
                assert len(l) == 5

def test_enum_report_3(shared_datadir):
    
    with tempfile.TemporaryDirectory() as output_dir:
        #output_dir = "test_out"
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "pDONR201_multi_genemark_domainator.gb"), "-o", out, "--sequence", "--length", "--architecture", "--cds_count", "--domain_count" ])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 5
            assert lines[0].strip().split("\t") == ["contig","sequence","length", "architecture", "cds_count", "domain_count"]
            for l_num in range(1,len(lines)):
                l = lines[l_num]
                l = l.strip().split("\t")
                assert f"pDONR201_{l_num}" == l[0]
                assert l[3] == "CcdB; CcdA; Condensation; 2-oxoacid_dh; CAT; Condensation; 2-oxoacid_dh; APH; TCAD9"
                assert l[4] == "6"
                assert l[5] == "9"
                assert l[1] == "CTTTCCTGCGTTATCCCCTGATTCTGTGGATAACCGTATTACCGCTAGCCAGGAAGAGTTTGTAGAAACGCAAAAAGGCCATCCGTCAGGATGGCCTTCTGCTTAGTTTGATGCCTGGCAGTTTATGGCGGGCGTCCTGCCCGCCACCCTCCGGGCCGTTGCTTCACAACGTTCAAATCCGCTCCCGGCGGATTTGTCCTACTCAGGAGAGCGTTCACCGACAAACAACAGATAAAACGAAAGGCCCAGTCTTCCGACTGAGCCTTTCGTTTTATTTGATGCCTGGCAGTTCCCTACTCTCGCGTTAACGCTAGCATGGATCTCGGGCCCCAAATAATGATTTTATTTTGACTGATAGTGACCTGTTCGTTGCAACAAATTGATGAGCAATGCTTTTTTATAATGCCAAGTTTGTACAAAAAAGCAGAACGAGAAACGTAAAATGATATAAATATCAATATATTAAATTAGATTTTGCATAAAAAACAGACTACATAATACTGTAAAACACAACATATCCAGTCACTATGAATCAACTACTTAGATGGTATTAGTGACCTGTAGTCGACCGACAGCCTTCCAAATGTTCTTCGGGTGATGCTGCCAACTTAGTCGACCGACAGCCTTCCAAATGTTCTTCTCAAACGGAATCGTCGTATCCAGCCTACTCGCTATTGTCCTCAATGCCGTATTAAATCATAAAAAGAAATAAGAAAAAGAGGTGCGAGCCTCTTTTTTGTGTGACAAAATAAAAACATCTACCTATTCATATACGCTAGTGTCATAGTCCTGAAAATCATCTGCATCAAGAACAATTTCACAACTCTTATACTTTTCTCTTACAAGTCGTTCGGCTTCATCTGGATTTTCAGCCTCTATACTTACTAAACGTGATAAAGTTTCTGTAATTTCTACTGTATCGACCTGCAGACTGGCTGTGTATAAGGGAGCCTGACATTTATATTCCCCAGAACATCAGGTTAATGGCGTTTTTGATGTCATTTTCGCGGTGGCTGAGATCAGCCACTTCTTCCCCGATAACGGAGACCGGCACACTGGCCATATCGGTGGTCATCATGCGCCAGCTTTCATCCCCGATATGCACCACCGGGTAAAGTTCACGGGAGACTTTATCTGACAGCAGACGTGCACTGGCCAGGGGGATCACCATCCGTCGCCCGGGCGTGTCAATAATATCACTCTGTACATCCACAAACAGACGATAACGGCTCTCTCTTTTATAGGTGTAAACCTTAAACTGCATTTCACCAGTCCCTGTTCTCGTCAGCAAAAGAGCCGTTCATTTCAATAAACCGGGCGACCTCAGCCATCCCTTCCTGATTTTCCGCTTTCCAGCGTTCGGCACGCAGACGACGGGCTTCATTCTGCATGGTTGTGCTTACCAGACCGGAGATATTGACATCATATATGCCTTGAGCAACTGATAGCTGTCGCTGTCAACTGTCACTGTAATACGCTGCTTCATAGCACACCTCTTTTTGACATACTTCGGGTATACATATCAGTATATATTCTTATACCGCAAAAATCAGCGCGCAAATACGCATACTGTTATCTGGCTTTTAGTAAGCCGGATCCACGCGATTACGCCCCGCCCTGCCACTCATCGCAGTACTGTTGTAATTCATTAAGCATTCTGCCGACATGGAAGCCATCACAGACGGCATGATGAACCTGAATCGCCAGCGGCATCAGCACCTTGTCGCCTTGCGTATAATATTTGCCCATGGTGAAAACGGGGGCGAAGAAGTTGTCCATATTGGCCACGTTTAAATCAAAACTGGTGAAACTCACCCAGGGATTGGCTGAGACGAAAAACATATTCTCAATAAACCCTTTAGGGAAATAGGCCAGGTTTTCACCGTAACACGCCACATCTTGCGAATATATGTGTAGAAACTGCCGGAAATCGTCGTGGTATTCACTCCAGAGCGATGAAAACGTTTCAGTTTGCTCATGGAAAACGGTGTAACAAGGGTGAACACTATCCCATATCACCAGCTCACCGTCTTTCATTGCCATACGGAATTCCGGATGAGCATTCATCAGGCGGGCAAGAATGTGAATAAAGGCCGGATAAAACTTGTGCTTATTTTTCTTTACGGTCTTTAAAAAGGCCGTAATATCCAGCTGAACGGTCTGGTTATAGGTACATTGAGCAACTGACTGAAATGCCTCAAAATGTTCTTTACGATGCCATTGGGATATATCAACGGTGGTATATCCAGTGATTTTTTTCTCCATTTTAGCTTCCTTAGCTCCTGAAAATCTCGATAACTCAAAAAATACGCCCGGTAGTGATCTTATTTCATTATGGTGAAAGTTGGAACCTCTTACGTGCCGATCAACGTCTCATTTTCGCCAAAAGTTGGCCCAGGGCTTCCCGGTATCAACAGGGACACCAGGATTTATTTATTCTGCGAAGTGATCTTCCGTCACAGGTATTTATTCGGCGCAAAGTGCGTCGGGTGATGCTGCCAACTTAGTCGACTACAGGTCACTAATACCATCTAAGTAGTTGATTCATAGTGACTGGATATGTTGTGTTTTACAGTATTATGTAGTCTGTTTTTTATGCAAAATCTAATTTAATATATTGATATTTATATCATTTTACGTTTCTCGTTCAGCTTTCTTGTACAAAGTGGGCATTATAAGAAAGCATTGCTTATCAATTTGTTGCAACGAACAGGTCACTATCAGTCAAAATAAAATCATTATTTGCCATCCAGCTGCAGCTCTGGCCCGTGTCTCAAAATCTCTGATGTTACATTGCACAAGATAAAAATATATCATCATGAACAATAAAACTGTCTGCTTACATAAACAGTAATACAAGGGGTGTTATGAGCCATATTCAACGGGAAACGTCGAGGCCGCGATTAAATTCCAACATGGATGCTGATTTATATGGGTATAAATGGGCTCGCGATAATGTCGGGCAATCAGGTGCGACAATCTATCGCTTGTATGGGAAGCCCGATGCGCCAGAGTTGTTTCTGAAACATGGCAAAGGTAGCGTTGCCAATGATGTTACAGATGAGATGGTCAGACTAAACTGGCTGACGGAATTTATGCCTCTTCCGACCATCAAGCATTTTATCCGTACTCCTGATGATGCATGGTTACTCACCACTGCGATCCCCGGAAAAACAGCATTCCAGGTATTAGAAGAATATCCTGATTCAGGTGAAAATATTGTTGATGCGCTGGCAGTGTTCCTGCGCCGGTTGCATTCGATTCCTGTTTGTAATTGTCCTTTTAACAGCGATCGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAGTTTCATTTGATGCTCGATGAGTTTTTCTAATCAGAATTGGTTAATTGGTTGTAACACTGGCAGAGCATTACGCTGACTTGACGGGACGGCGCAAGCTCATGACCAAAATCCCTTAACGTGAGTTTTCGTTCCACTGAGCGTCAGACCCCGTAGAAAAGATCAAAGGATCTTCTTGAGATCCTTTTTTTCTGCGCGTAATCTGCTGCTTGCAAACAAAAAAACCACCGCTACCAGCGGTGGTTTGTTTGCCGGATCAAGAGCTACCAACTCTTTTTCCGAAGGTAACTGGCTTCAGCAGAGCGCAGATACCAAATACTGTCCTTCTAGTGTAGCCGTAGTTAGGCCACCACTTCAAGAACTCTGTAGCACCGCCTACATACCTCGCTCTGCTAATCCTGTTACCAGTGGCTGCTGCCAGTGGCGATAAGTCGTGTCTTACCGGGTTGGACTCAAGACGATAGTTACCGGATAAGGCGCAGCGGTCGGGCTGAACGGGGGGTTCGTGCACACAGCCCAGCTTGGAGCGAACGACCTACACCGAACTGAGATACCTACAGCGTGAGCTATGAGAAAGCGCCACGCTTCCCGAAGGGAGAAAGGCGGACAGGTATCCGGTAAGCGGCAGGGTCGGAACAGGAGAGCGCACGAGGGAGCTTCCAGGGGGAAACGCCTGGTATCTTTATAGTCCTGTCGGGTTTCGCCACCTCTGACTTGAGCGTCGATTTTTGTGATGCTCGTCAGGGGGGCGGAGCCTATGGAAAAACGCCAGCAACGCGGCCTTTTTACGGTTCCTGGCCTTTTGCTGGCCTTTTGCTCACATGTT"
                assert l[2] == "4470"
                assert len(l) == 6

def test_enum_report_circular_1(shared_datadir):
    
    with tempfile.TemporaryDirectory() as output_dir:
        #output_dir = "test_out"
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "pDONR201_domainator_circular.gb"), "-o", out, "--domains", "--sequence", "--length", "--topology" ])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 2
            assert lines[0].strip().split("\t") == ["contig","domains","sequence","length","topology"]
            for l_num in range(1,len(lines)):
                l = lines[l_num]
                l = l.strip().split("\t")
                assert f"pDONR201" == l[0]
                assert l[1] == "2-oxoacid_dh; APH; CAT; CcdB; Condensation; TCAD9"
                assert l[2] == "CTTTCCTGCGTTATCCCCTGATTCTGTGGATAACCGTATTACCGCTAGCCAGGAAGAGTTTGTAGAAACGCAAAAAGGCCATCCGTCAGGATGGCCTTCTGCTTAGTTTGATGCCTGGCAGTTTATGGCGGGCGTCCTGCCCGCCACCCTCCGGGCCGTTGCTTCACAACGTTCAAATCCGCTCCCGGCGGATTTGTCCTACTCAGGAGAGCGTTCACCGACAAACAACAGATAAAACGAAAGGCCCAGTCTTCCGACTGAGCCTTTCGTTTTATTTGATGCCTGGCAGTTCCCTACTCTCGCGTTAACGCTAGCATGGATCTCGGGCCCCAAATAATGATTTTATTTTGACTGATAGTGACCTGTTCGTTGCAACAAATTGATGAGCAATGCTTTTTTATAATGCCAAGTTTGTACAAAAAAGCAGAACGAGAAACGTAAAATGATATAAATATCAATATATTAAATTAGATTTTGCATAAAAAACAGACTACATAATACTGTAAAACACAACATATCCAGTCACTATGAATCAACTACTTAGATGGTATTAGTGACCTGTAGTCGACCGACAGCCTTCCAAATGTTCTTCGGGTGATGCTGCCAACTTAGTCGACCGACAGCCTTCCAAATGTTCTTCTCAAACGGAATCGTCGTATCCAGCCTACTCGCTATTGTCCTCAATGCCGTATTAAATCATAAAAAGAAATAAGAAAAAGAGGTGCGAGCCTCTTTTTTGTGTGACAAAATAAAAACATCTACCTATTCATATACGCTAGTGTCATAGTCCTGAAAATCATCTGCATCAAGAACAATTTCACAACTCTTATACTTTTCTCTTACAAGTCGTTCGGCTTCATCTGGATTTTCAGCCTCTATACTTACTAAACGTGATAAAGTTTCTGTAATTTCTACTGTATCGACCTGCAGACTGGCTGTGTATAAGGGAGCCTGACATTTATATTCCCCAGAACATCAGGTTAATGGCGTTTTTGATGTCATTTTCGCGGTGGCTGAGATCAGCCACTTCTTCCCCGATAACGGAGACCGGCACACTGGCCATATCGGTGGTCATCATGCGCCAGCTTTCATCCCCGATATGCACCACCGGGTAAAGTTCACGGGAGACTTTATCTGACAGCAGACGTGCACTGGCCAGGGGGATCACCATCCGTCGCCCGGGCGTGTCAATAATATCACTCTGTACATCCACAAACAGACGATAACGGCTCTCTCTTTTATAGGTGTAAACCTTAAACTGCATTTCACCAGTCCCTGTTCTCGTCAGCAAAAGAGCCGTTCATTTCAATAAACCGGGCGACCTCAGCCATCCCTTCCTGATTTTCCGCTTTCCAGCGTTCGGCACGCAGACGACGGGCTTCATTCTGCATGGTTGTGCTTACCAGACCGGAGATATTGACATCATATATGCCTTGAGCAACTGATAGCTGTCGCTGTCAACTGTCACTGTAATACGCTGCTTCATAGCACACCTCTTTTTGACATACTTCGGGTATACATATCAGTATATATTCTTATACCGCAAAAATCAGCGCGCAAATACGCATACTGTTATCTGGCTTTTAGTAAGCCGGATCCACGCGATTACGCCCCGCCCTGCCACTCATCGCAGTACTGTTGTAATTCATTAAGCATTCTGCCGACATGGAAGCCATCACAGACGGCATGATGAACCTGAATCGCCAGCGGCATCAGCACCTTGTCGCCTTGCGTATAATATTTGCCCATGGTGAAAACGGGGGCGAAGAAGTTGTCCATATTGGCCACGTTTAAATCAAAACTGGTGAAACTCACCCAGGGATTGGCTGAGACGAAAAACATATTCTCAATAAACCCTTTAGGGAAATAGGCCAGGTTTTCACCGTAACACGCCACATCTTGCGAATATATGTGTAGAAACTGCCGGAAATCGTCGTGGTATTCACTCCAGAGCGATGAAAACGTTTCAGTTTGCTCATGGAAAACGGTGTAACAAGGGTGAACACTATCCCATATCACCAGCTCACCGTCTTTCATTGCCATACGGAATTCCGGATGAGCATTCATCAGGCGGGCAAGAATGTGAATAAAGGCCGGATAAAACTTGTGCTTATTTTTCTTTACGGTCTTTAAAAAGGCCGTAATATCCAGCTGAACGGTCTGGTTATAGGTACATTGAGCAACTGACTGAAATGCCTCAAAATGTTCTTTACGATGCCATTGGGATATATCAACGGTGGTATATCCAGTGATTTTTTTCTCCATTTTAGCTTCCTTAGCTCCTGAAAATCTCGATAACTCAAAAAATACGCCCGGTAGTGATCTTATTTCATTATGGTGAAAGTTGGAACCTCTTACGTGCCGATCAACGTCTCATTTTCGCCAAAAGTTGGCCCAGGGCTTCCCGGTATCAACAGGGACACCAGGATTTATTTATTCTGCGAAGTGATCTTCCGTCACAGGTATTTATTCGGCGCAAAGTGCGTCGGGTGATGCTGCCAACTTAGTCGACTACAGGTCACTAATACCATCTAAGTAGTTGATTCATAGTGACTGGATATGTTGTGTTTTACAGTATTATGTAGTCTGTTTTTTATGCAAAATCTAATTTAATATATTGATATTTATATCATTTTACGTTTCTCGTTCAGCTTTCTTGTACAAAGTGGGCATTATAAGAAAGCATTGCTTATCAATTTGTTGCAACGAACAGGTCACTATCAGTCAAAATAAAATCATTATTTGCCATCCAGCTGCAGCTCTGGCCCGTGTCTCAAAATCTCTGATGTTACATTGCACAAGATAAAAATATATCATCATGAACAATAAAACTGTCTGCTTACATAAACAGTAATACAAGGGGTGTTATGAGCCATATTCAACGGGAAACGTCGAGGCCGCGATTAAATTCCAACATGGATGCTGATTTATATGGGTATAAATGGGCTCGCGATAATGTCGGGCAATCAGGTGCGACAATCTATCGCTTGTATGGGAAGCCCGATGCGCCAGAGTTGTTTCTGAAACATGGCAAAGGTAGCGTTGCCAATGATGTTACAGATGAGATGGTCAGACTAAACTGGCTGACGGAATTTATGCCTCTTCCGACCATCAAGCATTTTATCCGTACTCCTGATGATGCATGGTTACTCACCACTGCGATCCCCGGAAAAACAGCATTCCAGGTATTAGAAGAATATCCTGATTCAGGTGAAAATATTGTTGATGCGCTGGCAGTGTTCCTGCGCCGGTTGCATTCGATTCCTGTTTGTAATTGTCCTTTTAACAGCGATCGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAGTTTCATTTGATGCTCGATGAGTTTTTCTAATCAGAATTGGTTAATTGGTTGTAACACTGGCAGAGCATTACGCTGACTTGACGGGACGGCGCAAGCTCATGACCAAAATCCCTTAACGTGAGTTTTCGTTCCACTGAGCGTCAGACCCCGTAGAAAAGATCAAAGGATCTTCTTGAGATCCTTTTTTTCTGCGCGTAATCTGCTGCTTGCAAACAAAAAAACCACCGCTACCAGCGGTGGTTTGTTTGCCGGATCAAGAGCTACCAACTCTTTTTCCGAAGGTAACTGGCTTCAGCAGAGCGCAGATACCAAATACTGTCCTTCTAGTGTAGCCGTAGTTAGGCCACCACTTCAAGAACTCTGTAGCACCGCCTACATACCTCGCTCTGCTAATCCTGTTACCAGTGGCTGCTGCCAGTGGCGATAAGTCGTGTCTTACCGGGTTGGACTCAAGACGATAGTTACCGGATAAGGCGCAGCGGTCGGGCTGAACGGGGGGTTCGTGCACACAGCCCAGCTTGGAGCGAACGACCTACACCGAACTGAGATACCTACAGCGTGAGCTATGAGAAAGCGCCACGCTTCCCGAAGGGAGAAAGGCGGACAGGTATCCGGTAAGCGGCAGGGTCGGAACAGGAGAGCGCACGAGGGAGCTTCCAGGGGGAAACGCCTGGTATCTTTATAGTCCTGTCGGGTTTCGCCACCTCTGACTTGAGCGTCGATTTTTGTGATGCTCGTCAGGGGGGCGGAGCCTATGGAAAAACGCCAGCAACGCGGCCTTTTTACGGTTCCTGGCCTTTTGCTGGCCTTTTGCTCACATGTT"
                assert l[3] == "4470"
                assert l[4] == "circular"
                assert len(l) == 5


def test_enum_report_named_domain_count_1(shared_datadir):
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main([
            "-i", str(shared_datadir / "pDONR201_multi_genemark_domainator.gb"),
            "-o", out,
            "--named_domain_count", "CcdB",
            "--named_domain_count", "Condensation",
        ])
        assert Path(out).is_file()

        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 5
            assert lines[0].strip().split("\t") == [
                "contig",
                "named_domain_count_CcdB",
                "named_domain_count_Condensation",
            ]
            for l_num in range(1, len(lines)):
                l = lines[l_num].strip().split("\t")
                assert f"pDONR201_{l_num}" == l[0]
                assert l[1] == "1"
                assert l[2] == "2"

def test_enum_report_cds_1(shared_datadir):
    reference = [
"pDONR201_1	pDONR201_1		TTTCCTGCGTTATCCCCTGATTCTGTGGATAACCGTATTACCGCTAGCCAGGAAGAGTTTGTAGAAACGCAAAAAGGCCATCCGTCAGGATGGCCTTCTGCTTAG	105		0.0",
"pDONR201_1	pDONR201_2	CcdB	ATGCAGTTTAAGGTTTACACCTATAAAAGAGAGAGCCGTTATCGTCTGTTTGTGGATGTACAGAGTGATATTATTGACACGCCCGGGCGACGGATGGTGATCCCCCTGGCCAGTGCACGTCTGCTGTCAGATAAAGTCTCCCGTGAACTTTACCCGGTGGTGCATATCGGGGATGAAAGCTGGCGCATGATGACCACCGATATGGCCAGTGTGCCGGTCTCCGTTATCGGGGAAGAAGTGGCTGATCTCAGCCACCGCGAAAATGACATCAAAAACGCCATTAACCTGATGTTCTGGGGAATATAA	306	CcdB	103.1",
"pDONR201_1	pDONR201_3	CcdA	ATGCAGAATGAAGCCCGTCGTCTGCGTGCCGAACGCTGGAAAGCGGAAAATCAGGAAGGGATGGCTGAGGTCGCCCGGTTTATTGAAATGAACGGCTCTTTTGCTGACGAGAACAGGGACTGGTGA	126	CcdA	50.2",
"pDONR201_1	pDONR201_4	2-oxoacid_dh; CAT; Condensation	ATGGAGAAAAAAATCACTGGATATACCACCGTTGATATATCCCAATGGCATCGTAAAGAACATTTTGAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCTTGTTACACCGTTTTCCATGAGCAAACTGAAACGTTTTCATCGCTCTGGAGTGAATACCACGACGATTTCCGGCAGTTTCTACACATATATTCGCAAGATGTGGCGTGTTACGGTGAAAACCTGGCCTATTTCCCTAAAGGGTTTATTGAGAATATGTTTTTCGTCTCAGCCAATCCCTGGGTGAGTTTCACCAGTTTTGATTTAAACGTGGCCAATATGGACAACTTCTTCGCCCCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAACAGTACTGCGATGAGTGGCAGGGCGGGGCGTAA	660	CAT; 2-oxoacid_dh; Condensation; 2-oxoacid_dh; Condensation	354.0",
"pDONR201_1	pDONR201_5	APH; TCAD9	ATGGATGCTGATTTATATGGGTATAAATGGGCTCGCGATAATGTCGGGCAATCAGGTGCGACAATCTATCGCTTGTATGGGAAGCCCGATGCGCCAGAGTTGTTTCTGAAACATGGCAAAGGTAGCGTTGCCAATGATGTTACAGATGAGATGGTCAGACTAAACTGGCTGACGGAATTTATGCCTCTTCCGACCATCAAGCATTTTATCCGTACTCCTGATGATGCATGGTTACTCACCACTGCGATCCCCGGAAAAACAGCATTCCAGGTATTAGAAGAATATCCTGATTCAGGTGAAAATATTGTTGATGCGCTGGCAGTGTTCCTGCGCCGGTTGCATTCGATTCCTGTTTGTAATTGTCCTTTTAACAGCGATCGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAGTTTCATTTGATGCTCGATGAGTTTTTCTAA	762	APH; TCAD9	101.0",
"pDONR201_1	pDONR201_6		ATGCTCGTCAGGGGGGCGGAGCCTATGGAAAAACGCCAGCAACGCGGCCTTTTTACGGTTCCTGGCCTTTTGCTGGCCTTTTGCTCACATGTT	93		0.0",
"pDONR201_2	pDONR201_1		TTTCCTGCGTTATCCCCTGATTCTGTGGATAACCGTATTACCGCTAGCCAGGAAGAGTTTGTAGAAACGCAAAAAGGCCATCCGTCAGGATGGCCTTCTGCTTAG	105		0.0",
"pDONR201_2	pDONR201_2	CcdB	ATGCAGTTTAAGGTTTACACCTATAAAAGAGAGAGCCGTTATCGTCTGTTTGTGGATGTACAGAGTGATATTATTGACACGCCCGGGCGACGGATGGTGATCCCCCTGGCCAGTGCACGTCTGCTGTCAGATAAAGTCTCCCGTGAACTTTACCCGGTGGTGCATATCGGGGATGAAAGCTGGCGCATGATGACCACCGATATGGCCAGTGTGCCGGTCTCCGTTATCGGGGAAGAAGTGGCTGATCTCAGCCACCGCGAAAATGACATCAAAAACGCCATTAACCTGATGTTCTGGGGAATATAA	306	CcdB	103.1",
"pDONR201_2	pDONR201_3	CcdA	ATGCAGAATGAAGCCCGTCGTCTGCGTGCCGAACGCTGGAAAGCGGAAAATCAGGAAGGGATGGCTGAGGTCGCCCGGTTTATTGAAATGAACGGCTCTTTTGCTGACGAGAACAGGGACTGGTGA	126	CcdA	50.2",
"pDONR201_2	pDONR201_4	2-oxoacid_dh; CAT; Condensation	ATGGAGAAAAAAATCACTGGATATACCACCGTTGATATATCCCAATGGCATCGTAAAGAACATTTTGAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCTTGTTACACCGTTTTCCATGAGCAAACTGAAACGTTTTCATCGCTCTGGAGTGAATACCACGACGATTTCCGGCAGTTTCTACACATATATTCGCAAGATGTGGCGTGTTACGGTGAAAACCTGGCCTATTTCCCTAAAGGGTTTATTGAGAATATGTTTTTCGTCTCAGCCAATCCCTGGGTGAGTTTCACCAGTTTTGATTTAAACGTGGCCAATATGGACAACTTCTTCGCCCCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAACAGTACTGCGATGAGTGGCAGGGCGGGGCGTAA	660	CAT; 2-oxoacid_dh; Condensation; 2-oxoacid_dh; Condensation	354.0",
"pDONR201_2	pDONR201_5	APH; TCAD9	ATGGATGCTGATTTATATGGGTATAAATGGGCTCGCGATAATGTCGGGCAATCAGGTGCGACAATCTATCGCTTGTATGGGAAGCCCGATGCGCCAGAGTTGTTTCTGAAACATGGCAAAGGTAGCGTTGCCAATGATGTTACAGATGAGATGGTCAGACTAAACTGGCTGACGGAATTTATGCCTCTTCCGACCATCAAGCATTTTATCCGTACTCCTGATGATGCATGGTTACTCACCACTGCGATCCCCGGAAAAACAGCATTCCAGGTATTAGAAGAATATCCTGATTCAGGTGAAAATATTGTTGATGCGCTGGCAGTGTTCCTGCGCCGGTTGCATTCGATTCCTGTTTGTAATTGTCCTTTTAACAGCGATCGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAGTTTCATTTGATGCTCGATGAGTTTTTCTAA	762	APH; TCAD9	101.0",
"pDONR201_2	pDONR201_6		ATGCTCGTCAGGGGGGCGGAGCCTATGGAAAAACGCCAGCAACGCGGCCTTTTTACGGTTCCTGGCCTTTTGCTGGCCTTTTGCTCACATGTT	93		0.0",
"pDONR201_3	pDONR201_1		TTTCCTGCGTTATCCCCTGATTCTGTGGATAACCGTATTACCGCTAGCCAGGAAGAGTTTGTAGAAACGCAAAAAGGCCATCCGTCAGGATGGCCTTCTGCTTAG	105		0.0",
"pDONR201_3	pDONR201_2	CcdB	ATGCAGTTTAAGGTTTACACCTATAAAAGAGAGAGCCGTTATCGTCTGTTTGTGGATGTACAGAGTGATATTATTGACACGCCCGGGCGACGGATGGTGATCCCCCTGGCCAGTGCACGTCTGCTGTCAGATAAAGTCTCCCGTGAACTTTACCCGGTGGTGCATATCGGGGATGAAAGCTGGCGCATGATGACCACCGATATGGCCAGTGTGCCGGTCTCCGTTATCGGGGAAGAAGTGGCTGATCTCAGCCACCGCGAAAATGACATCAAAAACGCCATTAACCTGATGTTCTGGGGAATATAA	306	CcdB	103.1",
"pDONR201_3	pDONR201_3	CcdA	ATGCAGAATGAAGCCCGTCGTCTGCGTGCCGAACGCTGGAAAGCGGAAAATCAGGAAGGGATGGCTGAGGTCGCCCGGTTTATTGAAATGAACGGCTCTTTTGCTGACGAGAACAGGGACTGGTGA	126	CcdA	50.2",
"pDONR201_3	pDONR201_4	2-oxoacid_dh; CAT; Condensation	ATGGAGAAAAAAATCACTGGATATACCACCGTTGATATATCCCAATGGCATCGTAAAGAACATTTTGAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCTTGTTACACCGTTTTCCATGAGCAAACTGAAACGTTTTCATCGCTCTGGAGTGAATACCACGACGATTTCCGGCAGTTTCTACACATATATTCGCAAGATGTGGCGTGTTACGGTGAAAACCTGGCCTATTTCCCTAAAGGGTTTATTGAGAATATGTTTTTCGTCTCAGCCAATCCCTGGGTGAGTTTCACCAGTTTTGATTTAAACGTGGCCAATATGGACAACTTCTTCGCCCCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAACAGTACTGCGATGAGTGGCAGGGCGGGGCGTAA	660	CAT; 2-oxoacid_dh; Condensation; 2-oxoacid_dh; Condensation	354.0",
"pDONR201_3	pDONR201_5	APH; TCAD9	ATGGATGCTGATTTATATGGGTATAAATGGGCTCGCGATAATGTCGGGCAATCAGGTGCGACAATCTATCGCTTGTATGGGAAGCCCGATGCGCCAGAGTTGTTTCTGAAACATGGCAAAGGTAGCGTTGCCAATGATGTTACAGATGAGATGGTCAGACTAAACTGGCTGACGGAATTTATGCCTCTTCCGACCATCAAGCATTTTATCCGTACTCCTGATGATGCATGGTTACTCACCACTGCGATCCCCGGAAAAACAGCATTCCAGGTATTAGAAGAATATCCTGATTCAGGTGAAAATATTGTTGATGCGCTGGCAGTGTTCCTGCGCCGGTTGCATTCGATTCCTGTTTGTAATTGTCCTTTTAACAGCGATCGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAGTTTCATTTGATGCTCGATGAGTTTTTCTAA	762	APH; TCAD9	101.0",
"pDONR201_3	pDONR201_6		ATGCTCGTCAGGGGGGCGGAGCCTATGGAAAAACGCCAGCAACGCGGCCTTTTTACGGTTCCTGGCCTTTTGCTGGCCTTTTGCTCACATGTT	93		0.0",
"pDONR201_4	pDONR201_1		TTTCCTGCGTTATCCCCTGATTCTGTGGATAACCGTATTACCGCTAGCCAGGAAGAGTTTGTAGAAACGCAAAAAGGCCATCCGTCAGGATGGCCTTCTGCTTAG	105		0.0",
"pDONR201_4	pDONR201_2	CcdB	ATGCAGTTTAAGGTTTACACCTATAAAAGAGAGAGCCGTTATCGTCTGTTTGTGGATGTACAGAGTGATATTATTGACACGCCCGGGCGACGGATGGTGATCCCCCTGGCCAGTGCACGTCTGCTGTCAGATAAAGTCTCCCGTGAACTTTACCCGGTGGTGCATATCGGGGATGAAAGCTGGCGCATGATGACCACCGATATGGCCAGTGTGCCGGTCTCCGTTATCGGGGAAGAAGTGGCTGATCTCAGCCACCGCGAAAATGACATCAAAAACGCCATTAACCTGATGTTCTGGGGAATATAA	306	CcdB	103.1",
"pDONR201_4	pDONR201_3	CcdA	ATGCAGAATGAAGCCCGTCGTCTGCGTGCCGAACGCTGGAAAGCGGAAAATCAGGAAGGGATGGCTGAGGTCGCCCGGTTTATTGAAATGAACGGCTCTTTTGCTGACGAGAACAGGGACTGGTGA	126	CcdA	50.2",
"pDONR201_4	pDONR201_4	2-oxoacid_dh; CAT; Condensation	ATGGAGAAAAAAATCACTGGATATACCACCGTTGATATATCCCAATGGCATCGTAAAGAACATTTTGAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCTTGTTACACCGTTTTCCATGAGCAAACTGAAACGTTTTCATCGCTCTGGAGTGAATACCACGACGATTTCCGGCAGTTTCTACACATATATTCGCAAGATGTGGCGTGTTACGGTGAAAACCTGGCCTATTTCCCTAAAGGGTTTATTGAGAATATGTTTTTCGTCTCAGCCAATCCCTGGGTGAGTTTCACCAGTTTTGATTTAAACGTGGCCAATATGGACAACTTCTTCGCCCCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAACAGTACTGCGATGAGTGGCAGGGCGGGGCGTAA	660	CAT; 2-oxoacid_dh; Condensation; 2-oxoacid_dh; Condensation	354.0",
"pDONR201_4	pDONR201_5	APH; TCAD9	ATGGATGCTGATTTATATGGGTATAAATGGGCTCGCGATAATGTCGGGCAATCAGGTGCGACAATCTATCGCTTGTATGGGAAGCCCGATGCGCCAGAGTTGTTTCTGAAACATGGCAAAGGTAGCGTTGCCAATGATGTTACAGATGAGATGGTCAGACTAAACTGGCTGACGGAATTTATGCCTCTTCCGACCATCAAGCATTTTATCCGTACTCCTGATGATGCATGGTTACTCACCACTGCGATCCCCGGAAAAACAGCATTCCAGGTATTAGAAGAATATCCTGATTCAGGTGAAAATATTGTTGATGCGCTGGCAGTGTTCCTGCGCCGGTTGCATTCGATTCCTGTTTGTAATTGTCCTTTTAACAGCGATCGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAGTTTCATTTGATGCTCGATGAGTTTTTCTAA	762	APH; TCAD9	101.0",
"pDONR201_4	pDONR201_6		ATGCTCGTCAGGGGGGCGGAGCCTATGGAAAAACGCCAGCAACGCGGCCTTTTTACGGTTCCTGGCCTTTTGCTGGCCTTTTGCTCACATGTT	93		0.0",
]
    with tempfile.TemporaryDirectory() as output_dir:
        #output_dir = "test_out"
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "pDONR201_multi_genemark_domainator.gb"), "--by", "cds", "-o", out, "--domains", "--sequence", "--length", "--architecture", "--score"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 25
            assert lines[0].strip().split("\t") == ["contig", "cds", "domains", "sequence", "length", "architecture", "score"]
            for l_num in range(1,len(lines)):
                l = lines[l_num]
                l = l.strip().split("\t")
                ref_line = reference[l_num-1].strip().split("\t")
                assert len(ref_line) == len(l)
                for i in range(len(ref_line)):
                    assert ref_line[i] == l[i]


def test_enum_report_domain_1(shared_datadir):
    
    reference =[
"pDONR201_1	pDONR201_2	CcdB	CcdB	CAGTTTAAGGTTTACACCTATAAAAGAGAGAGCCGTTATCGTCTGTTTGTGGATGTACAGAGTGATATTATTGACACGCCCGGGCGACGGATGGTGATCCCCCTGGCCAGTGCACGTCTGCTGTCAGATAAAGTCTCCCGTGAACTTTACCCGGTGGTGCATATCGGGGATGAAAGCTGGCGCATGATGACCACCGATATGGCCAGTGTGCCGGTCTCCGTTATCGGGGAAGAAGTGGCTGATCTCAGCCACCGCGAAAATGACATCAAAAACGCCATTAACCTGATGTTCTGGGGA	297	CcdB	103.1",
"pDONR201_1	pDONR201_3	CcdA	CcdA	ATGCAGAATGAAGCCCGTCGTCTGCGTGCCGAACGCTGGAAAGCGGAAAATCAGGAAGGGATGGCTGAGGTCGCCCGGTTTATTGAAATGAACGGCTCTTTTGCTGACGAGAACAGGGACTGG	123	CcdA	50.2",
"pDONR201_1	pDONR201_4	Condensation	Condensation	CCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAACAGTACTGCGATGAGTGGCAGGGCGGGGCG	153	Condensation	11.2",
"pDONR201_1	pDONR201_4	2-oxoacid_dh	2-oxoacid_dh	GCCCCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAACAGTACTGCGATGAGTGGCAGGGC	150	2-oxoacid_dh	7.3",
"pDONR201_1	pDONR201_4	CAT	CAT	TATACCACCGTTGATATATCCCAATGGCATCGTAAAGAACATTTTGAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCTTGTTACACCGTTTTCCATGAGCAAACTGAAACGTTTTCATCGCTCTGGAGTGAATACCACGACGATTTCCGGCAGTTTCTACACATATATTCGCAAGATGTGGCGTGTTACGGTGAAAACCTGGCCTATTTCCCTAAAGGGTTTATTGAGAATATGTTTTTCGTCTCAGCCAATCCCTGGGTGAGTTTCACCAGTTTTGATTTAAACGTGGCCAATATGGACAACTTCTTCGCCCCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAA	606	CAT	329.7",
"pDONR201_1	pDONR201_4	Condensation	Condensation	GAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCTTGTTACACCGTTTTCCATGAGCAAACTGAAACGTTTTCA	243	Condensation	-1.2",
"pDONR201_1	pDONR201_4	2-oxoacid_dh	2-oxoacid_dh	GTTGATATATCCCAATGGCATCGTAAAGAACATTTTGAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCT	240	2-oxoacid_dh	7.0",
"pDONR201_1	pDONR201_5	APH	APH	AATGTCGGGCAATCAGGTGCGACAATCTATCGCTTGTATGGGAAGCCCGATGCGCCAGAGTTGTTTCTGAAACATGGCAAAGGTAGCGTTGCCAATGATGTTACAGATGAGATGGTCAGACTAAACTGGCTGACGGAATTTATGCCTCTTCCGACCATCAAGCATTTTATCCGTACTCCTGATGATGCATGGTTACTCACCACTGCGATCCCCGGAAAAACAGCATTCCAGGTATTAGAAGAATATCCTGATTCAGGTGAAAATATTGTTGATGCGCTGGCAGTGTTCCTGCGCCGGTTGCATTCGATTCCTGTTTGTAATTGTCCTTTTAACAGCGATCGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAGTTTCAT	699	APH	90.5",
"pDONR201_1	pDONR201_5	TCAD9	TCAD9	CGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAG	354	TCAD9	10.5",
"pDONR201_2	pDONR201_2	CcdB	CcdB	CAGTTTAAGGTTTACACCTATAAAAGAGAGAGCCGTTATCGTCTGTTTGTGGATGTACAGAGTGATATTATTGACACGCCCGGGCGACGGATGGTGATCCCCCTGGCCAGTGCACGTCTGCTGTCAGATAAAGTCTCCCGTGAACTTTACCCGGTGGTGCATATCGGGGATGAAAGCTGGCGCATGATGACCACCGATATGGCCAGTGTGCCGGTCTCCGTTATCGGGGAAGAAGTGGCTGATCTCAGCCACCGCGAAAATGACATCAAAAACGCCATTAACCTGATGTTCTGGGGA	297	CcdB	103.1",
"pDONR201_2	pDONR201_3	CcdA	CcdA	ATGCAGAATGAAGCCCGTCGTCTGCGTGCCGAACGCTGGAAAGCGGAAAATCAGGAAGGGATGGCTGAGGTCGCCCGGTTTATTGAAATGAACGGCTCTTTTGCTGACGAGAACAGGGACTGG	123	CcdA	50.2",
"pDONR201_2	pDONR201_4	Condensation	Condensation	CCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAACAGTACTGCGATGAGTGGCAGGGCGGGGCG	153	Condensation	11.2",
"pDONR201_2	pDONR201_4	2-oxoacid_dh	2-oxoacid_dh	GCCCCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAACAGTACTGCGATGAGTGGCAGGGC	150	2-oxoacid_dh	7.3",
"pDONR201_2	pDONR201_4	CAT	CAT	TATACCACCGTTGATATATCCCAATGGCATCGTAAAGAACATTTTGAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCTTGTTACACCGTTTTCCATGAGCAAACTGAAACGTTTTCATCGCTCTGGAGTGAATACCACGACGATTTCCGGCAGTTTCTACACATATATTCGCAAGATGTGGCGTGTTACGGTGAAAACCTGGCCTATTTCCCTAAAGGGTTTATTGAGAATATGTTTTTCGTCTCAGCCAATCCCTGGGTGAGTTTCACCAGTTTTGATTTAAACGTGGCCAATATGGACAACTTCTTCGCCCCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAA	606	CAT	329.7",
"pDONR201_2	pDONR201_4	Condensation	Condensation	GAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCTTGTTACACCGTTTTCCATGAGCAAACTGAAACGTTTTCA	243	Condensation	-1.2",
"pDONR201_2	pDONR201_4	2-oxoacid_dh	2-oxoacid_dh	GTTGATATATCCCAATGGCATCGTAAAGAACATTTTGAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCT	240	2-oxoacid_dh	7.0",
"pDONR201_2	pDONR201_5	APH	APH	AATGTCGGGCAATCAGGTGCGACAATCTATCGCTTGTATGGGAAGCCCGATGCGCCAGAGTTGTTTCTGAAACATGGCAAAGGTAGCGTTGCCAATGATGTTACAGATGAGATGGTCAGACTAAACTGGCTGACGGAATTTATGCCTCTTCCGACCATCAAGCATTTTATCCGTACTCCTGATGATGCATGGTTACTCACCACTGCGATCCCCGGAAAAACAGCATTCCAGGTATTAGAAGAATATCCTGATTCAGGTGAAAATATTGTTGATGCGCTGGCAGTGTTCCTGCGCCGGTTGCATTCGATTCCTGTTTGTAATTGTCCTTTTAACAGCGATCGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAGTTTCAT	699	APH	90.5",
"pDONR201_2	pDONR201_5	TCAD9	TCAD9	CGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAG	354	TCAD9	10.5",
"pDONR201_3	pDONR201_2	CcdB	CcdB	CAGTTTAAGGTTTACACCTATAAAAGAGAGAGCCGTTATCGTCTGTTTGTGGATGTACAGAGTGATATTATTGACACGCCCGGGCGACGGATGGTGATCCCCCTGGCCAGTGCACGTCTGCTGTCAGATAAAGTCTCCCGTGAACTTTACCCGGTGGTGCATATCGGGGATGAAAGCTGGCGCATGATGACCACCGATATGGCCAGTGTGCCGGTCTCCGTTATCGGGGAAGAAGTGGCTGATCTCAGCCACCGCGAAAATGACATCAAAAACGCCATTAACCTGATGTTCTGGGGA	297	CcdB	103.1",
"pDONR201_3	pDONR201_3	CcdA	CcdA	ATGCAGAATGAAGCCCGTCGTCTGCGTGCCGAACGCTGGAAAGCGGAAAATCAGGAAGGGATGGCTGAGGTCGCCCGGTTTATTGAAATGAACGGCTCTTTTGCTGACGAGAACAGGGACTGG	123	CcdA	50.2",
"pDONR201_3	pDONR201_4	Condensation	Condensation	CCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAACAGTACTGCGATGAGTGGCAGGGCGGGGCG	153	Condensation	11.2",
"pDONR201_3	pDONR201_4	2-oxoacid_dh	2-oxoacid_dh	GCCCCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAACAGTACTGCGATGAGTGGCAGGGC	150	2-oxoacid_dh	7.3",
"pDONR201_3	pDONR201_4	CAT	CAT	TATACCACCGTTGATATATCCCAATGGCATCGTAAAGAACATTTTGAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCTTGTTACACCGTTTTCCATGAGCAAACTGAAACGTTTTCATCGCTCTGGAGTGAATACCACGACGATTTCCGGCAGTTTCTACACATATATTCGCAAGATGTGGCGTGTTACGGTGAAAACCTGGCCTATTTCCCTAAAGGGTTTATTGAGAATATGTTTTTCGTCTCAGCCAATCCCTGGGTGAGTTTCACCAGTTTTGATTTAAACGTGGCCAATATGGACAACTTCTTCGCCCCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAA	606	CAT	329.7",
"pDONR201_3	pDONR201_4	Condensation	Condensation	GAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCTTGTTACACCGTTTTCCATGAGCAAACTGAAACGTTTTCA	243	Condensation	-1.2",
"pDONR201_3	pDONR201_4	2-oxoacid_dh	2-oxoacid_dh	GTTGATATATCCCAATGGCATCGTAAAGAACATTTTGAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCT	240	2-oxoacid_dh	7.0",
"pDONR201_3	pDONR201_5	APH	APH	AATGTCGGGCAATCAGGTGCGACAATCTATCGCTTGTATGGGAAGCCCGATGCGCCAGAGTTGTTTCTGAAACATGGCAAAGGTAGCGTTGCCAATGATGTTACAGATGAGATGGTCAGACTAAACTGGCTGACGGAATTTATGCCTCTTCCGACCATCAAGCATTTTATCCGTACTCCTGATGATGCATGGTTACTCACCACTGCGATCCCCGGAAAAACAGCATTCCAGGTATTAGAAGAATATCCTGATTCAGGTGAAAATATTGTTGATGCGCTGGCAGTGTTCCTGCGCCGGTTGCATTCGATTCCTGTTTGTAATTGTCCTTTTAACAGCGATCGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAGTTTCAT	699	APH	90.5",
"pDONR201_3	pDONR201_5	TCAD9	TCAD9	CGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAG	354	TCAD9	10.5",
"pDONR201_4	pDONR201_2	CcdB	CcdB	CAGTTTAAGGTTTACACCTATAAAAGAGAGAGCCGTTATCGTCTGTTTGTGGATGTACAGAGTGATATTATTGACACGCCCGGGCGACGGATGGTGATCCCCCTGGCCAGTGCACGTCTGCTGTCAGATAAAGTCTCCCGTGAACTTTACCCGGTGGTGCATATCGGGGATGAAAGCTGGCGCATGATGACCACCGATATGGCCAGTGTGCCGGTCTCCGTTATCGGGGAAGAAGTGGCTGATCTCAGCCACCGCGAAAATGACATCAAAAACGCCATTAACCTGATGTTCTGGGGA	297	CcdB	103.1",
"pDONR201_4	pDONR201_3	CcdA	CcdA	ATGCAGAATGAAGCCCGTCGTCTGCGTGCCGAACGCTGGAAAGCGGAAAATCAGGAAGGGATGGCTGAGGTCGCCCGGTTTATTGAAATGAACGGCTCTTTTGCTGACGAGAACAGGGACTGG	123	CcdA	50.2",
"pDONR201_4	pDONR201_4	Condensation	Condensation	CCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAACAGTACTGCGATGAGTGGCAGGGCGGGGCG	153	Condensation	11.2",
"pDONR201_4	pDONR201_4	2-oxoacid_dh	2-oxoacid_dh	GCCCCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAACAGTACTGCGATGAGTGGCAGGGC	150	2-oxoacid_dh	7.3",
"pDONR201_4	pDONR201_4	CAT	CAT	TATACCACCGTTGATATATCCCAATGGCATCGTAAAGAACATTTTGAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCTTGTTACACCGTTTTCCATGAGCAAACTGAAACGTTTTCATCGCTCTGGAGTGAATACCACGACGATTTCCGGCAGTTTCTACACATATATTCGCAAGATGTGGCGTGTTACGGTGAAAACCTGGCCTATTTCCCTAAAGGGTTTATTGAGAATATGTTTTTCGTCTCAGCCAATCCCTGGGTGAGTTTCACCAGTTTTGATTTAAACGTGGCCAATATGGACAACTTCTTCGCCCCCGTTTTCACCATGGGCAAATATTATACGCAAGGCGACAAGGTGCTGATGCCGCTGGCGATTCAGGTTCATCATGCCGTCTGTGATGGCTTCCATGTCGGCAGAATGCTTAATGAATTACAA	606	CAT	329.7",
"pDONR201_4	pDONR201_4	Condensation	Condensation	GAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCTTGTTACACCGTTTTCCATGAGCAAACTGAAACGTTTTCA	243	Condensation	-1.2",
"pDONR201_4	pDONR201_4	2-oxoacid_dh	2-oxoacid_dh	GTTGATATATCCCAATGGCATCGTAAAGAACATTTTGAGGCATTTCAGTCAGTTGCTCAATGTACCTATAACCAGACCGTTCAGCTGGATATTACGGCCTTTTTAAAGACCGTAAAGAAAAATAAGCACAAGTTTTATCCGGCCTTTATTCACATTCTTGCCCGCCTGATGAATGCTCATCCGGAATTCCGTATGGCAATGAAAGACGGTGAGCTGGTGATATGGGATAGTGTTCACCCT	240	2-oxoacid_dh	7.0",
"pDONR201_4	pDONR201_5	APH	APH	AATGTCGGGCAATCAGGTGCGACAATCTATCGCTTGTATGGGAAGCCCGATGCGCCAGAGTTGTTTCTGAAACATGGCAAAGGTAGCGTTGCCAATGATGTTACAGATGAGATGGTCAGACTAAACTGGCTGACGGAATTTATGCCTCTTCCGACCATCAAGCATTTTATCCGTACTCCTGATGATGCATGGTTACTCACCACTGCGATCCCCGGAAAAACAGCATTCCAGGTATTAGAAGAATATCCTGATTCAGGTGAAAATATTGTTGATGCGCTGGCAGTGTTCCTGCGCCGGTTGCATTCGATTCCTGTTTGTAATTGTCCTTTTAACAGCGATCGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAGTTTCAT	699	APH	90.5",
"pDONR201_4	pDONR201_5	TCAD9	TCAD9	CGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAG	354	TCAD9	10.5",

]
    with tempfile.TemporaryDirectory() as output_dir:
        # output_dir = "test_out"
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "pDONR201_multi_genemark_domainator.gb"), "--by", "domain", "-o", out, "--domains", "--sequence", "--length", "--architecture", "--score" ])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 37
            assert lines[0].strip().split("\t") == ["contig", "cds", "domain", "domains", "sequence","length", "architecture", "score"]
            
            for l_num in range(1,len(lines)):
                l = lines[l_num]
                l = l.strip().split("\t")
                ref_line = reference[l_num-1].strip().split("\t")
                assert len(ref_line) == len(l)
                for i in range(len(ref_line)):
                    assert ref_line[i] == l[i]

def test_enum_report_protein_domain_1(shared_datadir):
    
    reference = ["pDONR201_2	 	CcdB	CcdB	QFKVYTYKRESRYRLFVDVQSDIIDTPGRRMVIPLASARLLSDKVSRELYPVVHIGDESWRMMTTDMASVPVSVIGEEVADLSHRENDIKNAINLMFWG	99	CcdB	103.0",
"pDONR201_3	 	CcdA	CcdA	MQNEARRLRAERWKAENQEGMAEVARFIEMNGSFADENRDW	41	CcdA	50.1",
"pDONR201_4	 	CAT	CAT	VDISQWHRKEHFEAFQSVAQCTYNQTVQLDITAFLKTVKKNKHKFYPAFIHILARLMNAHPEFRMAMKDGELVIWDSVHPCYTVFHEQTETFSSLWSEYHDDFRQFLHIYSQDVACYGENLAYFPKGFIENMFFVSANPWVSFTSFDLNVANMDNFFAPVFTMGKYYTQGDKVLMPLAIQVHHAVCDGFHVGRMLNELQQYC	202	CAT	329.7",
"pDONR201_4	 	Condensation	Condensation	EKKITGYTTVDISQWHRKEHFEAFQSVAQCTY	32	Condensation	11.2",
"pDONR201_4	 	2-oxoacid_dh	2-oxoacid_dh	TGYTTVDISQWHRKEHFEAFQSVAQCTYNQT	31	2-oxoacid_dh	7.3",
"pDONR201_4	 	2-oxoacid_dh	2-oxoacid_dh	GFIENMFFVSANPWVSFTSFDLNVANMDNFFAPVFTMGKYYTQGDKVLMPLAIQVHHAVC	60	2-oxoacid_dh	7.0",
"pDONR201_4	 	Condensation	Condensation	IENMFFVSANPWVSFTSFDLN	21	Condensation	-1.2",
"pDONR201_5	 	APH	APH	TDEMVRLNWLTEFMPLPTIKHFIRTPDDAWLLTTAIPGKTAFQVLEEYPDSGENIVDALAVFLRRLHSIPVCNCPFNSDRVFRLAQAQSRMNNGLVDASDFDDERNGWPVEQVWKEMHKLLPFSPDSVVTHGDFSLDNLIFDEGKLIGCIDVGRVGIADRYQDLAILWNCLGEFSPSLQKRLFQKYGIDNP	191	APH	90.5",
"pDONR201_5	 	TCAD9	TCAD9	SVVTHGDFSLDNLIFDEGKLIGCIDVGRVGIADRYQDLAILWNCL	45	TCAD9	10.5",
]


    with tempfile.TemporaryDirectory() as output_dir:
        #output_dir = "test_out"
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "simple_genpept.gb"), "--by", "domain", "-o", out, "--domains", "--sequence",  "--length", "--architecture", "--score"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 10
            assert lines[0].strip().split("\t") == ["contig", "cds", "domain", "domains", "sequence", "length", "architecture", "score"]
            
            for l_num in range(1,len(lines)):
                l = lines[l_num]
                l = l.strip().split("\t")
                ref_line = reference[l_num-1].strip().split("\t")
                assert len(ref_line) == len(l)
                for i in range(len(ref_line)):
                    assert ref_line[i] == l[i]


def test_enum_report_rename_columns_1(shared_datadir):
    
    reference = ["pDONR201_2	 	CcdB	CcdB	QFKVYTYKRESRYRLFVDVQSDIIDTPGRRMVIPLASARLLSDKVSRELYPVVHIGDESWRMMTTDMASVPVSVIGEEVADLSHRENDIKNAINLMFWG	99	CcdB	103.0",
"pDONR201_3	 	CcdA	CcdA	MQNEARRLRAERWKAENQEGMAEVARFIEMNGSFADENRDW	41	CcdA	50.1",
"pDONR201_4	 	CAT	CAT	VDISQWHRKEHFEAFQSVAQCTYNQTVQLDITAFLKTVKKNKHKFYPAFIHILARLMNAHPEFRMAMKDGELVIWDSVHPCYTVFHEQTETFSSLWSEYHDDFRQFLHIYSQDVACYGENLAYFPKGFIENMFFVSANPWVSFTSFDLNVANMDNFFAPVFTMGKYYTQGDKVLMPLAIQVHHAVCDGFHVGRMLNELQQYC	202	CAT	329.7",
"pDONR201_4	 	Condensation	Condensation	EKKITGYTTVDISQWHRKEHFEAFQSVAQCTY	32	Condensation	11.2",
"pDONR201_4	 	2-oxoacid_dh	2-oxoacid_dh	TGYTTVDISQWHRKEHFEAFQSVAQCTYNQT	31	2-oxoacid_dh	7.3",
"pDONR201_4	 	2-oxoacid_dh	2-oxoacid_dh	GFIENMFFVSANPWVSFTSFDLNVANMDNFFAPVFTMGKYYTQGDKVLMPLAIQVHHAVC	60	2-oxoacid_dh	7.0",
"pDONR201_4	 	Condensation	Condensation	IENMFFVSANPWVSFTSFDLN	21	Condensation	-1.2",
"pDONR201_5	 	APH	APH	TDEMVRLNWLTEFMPLPTIKHFIRTPDDAWLLTTAIPGKTAFQVLEEYPDSGENIVDALAVFLRRLHSIPVCNCPFNSDRVFRLAQAQSRMNNGLVDASDFDDERNGWPVEQVWKEMHKLLPFSPDSVVTHGDFSLDNLIFDEGKLIGCIDVGRVGIADRYQDLAILWNCLGEFSPSLQKRLFQKYGIDNP	191	APH	90.5",
"pDONR201_5	 	TCAD9	TCAD9	SVVTHGDFSLDNLIFDEGKLIGCIDVGRVGIADRYQDLAILWNCL	45	TCAD9	10.5",
]

    new_column_names = ["contig2", "cdsasdfasdf", "domainr", "asdfe1324domains", "se asdfqu  ence", "length!@%!@#$GG", "architec turea1", "scoreasdf3546"]
    with tempfile.TemporaryDirectory() as output_dir:
        #output_dir = "test_out"
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "simple_genpept.gb"), "--by", "domain", "-o", out, "--domains", "--sequence",  "--length", "--architecture", "--score", "--column_names" ] + new_column_names)
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 10
            assert lines[0].strip().split("\t") == new_column_names
            
            for l_num in range(1,len(lines)):
                l = lines[l_num]
                l = l.strip().split("\t")
                ref_line = reference[l_num-1].strip().split("\t")
                assert len(ref_line) == len(l)
                for i in range(len(ref_line)):
                    assert ref_line[i] == l[i]

def test_enum_report_rename_columns_error_1(shared_datadir):
    

    with pytest.raises(ValueError):
        new_column_names = ["cdsasdfasdf", "domainr", "asdfe1324domains", "se asdfqu  ence", "length!@%!@#$GG", "architec turea1", "scoreasdf3546"]
        
        with tempfile.TemporaryDirectory() as output_dir:
            #output_dir = "test_out"
            out = output_dir + "/enum_report.tsv"
            enum_report.main(["-i", str(shared_datadir / "simple_genpept.gb"), "--by", "domain", "-o", out, "--domains", "--sequence",  "--length", "--architecture", "--score", "--column_names" ] + new_column_names)
        
def test_enum_report_html_1(shared_datadir):
    
    reference = shared_datadir / "enum_report_html_out.html"

    with tempfile.TemporaryDirectory() as output_dir:
        # output_dir = "test_out"
        out = output_dir + "/enum_report.html"
        enum_report.main(["-i", str(shared_datadir / "simple_genpept.gb"), "--by", "domain", "--html", out, "--domains", "--sequence",  "--length", "--architecture", "--score"])
        assert Path(out).is_file()
        
        compare_files(out, reference)


def test_enum_report_html_max_height_1(shared_datadir):
    
    reference = shared_datadir / "enum_report_html_max_size_out.html"

    with tempfile.TemporaryDirectory() as output_dir:
        # output_dir = "test_out"
        out = output_dir + "/enum_report.html"
        enum_report.main(["-i", str(shared_datadir / "simple_genpept.gb"), "--by", "domain", "--html", out, "--html_max_height", "100", "--domains", "--sequence",  "--length", "--architecture", "--score"])
        assert Path(out).is_file()
        
        compare_files(out, reference)
        
def test_enum_report_html_quote_escape_1(shared_datadir):
    
    reference = shared_datadir / "enum_report_html_out_quote_escape.html"

    with tempfile.TemporaryDirectory() as output_dir:
        # output_dir = "test_out"
        out = output_dir + "/enum_report.html"
        enum_report.main(["-i", str(shared_datadir / "simple_genpept_quote_name.gb"), "--by", "domain", "--html", out, "--domains", "--sequence",  "--length", "--architecture", "--score"])
        assert Path(out).is_file()
        
        compare_files(out, reference)


def test_enum_report_taxonomy_1(shared_datadir):
    
    with tempfile.TemporaryDirectory() as output_dir:
        # output_dir = "test_out"
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "swissprot_CuSOD_subset.fasta"), "-o", out, "--ncbi_taxonomy_path", str(shared_datadir / "taxdmp"), '--taxid_lineage', '--taxname_lineage', '--taxid', "self", "superkingdom", "genus", "--taxname", "self", "superkingdom", "genus", "--domain_descriptions", '--append', 'one', 'int', '1', '--append', 'two', 'float', '2.0', '--append', 'three', 'str', 'three'])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 3
            for i, l in enumerate(lines):
                lines[i] = lines[i].rstrip("\r\n").split("\t")
            assert lines[0] == ["contig", "taxid_lineage", "taxid_lineage", "taxid_self", "taxid_superkingdom", "taxid_genus", "taxname_self", "taxname_superkingdom", "taxname_genus", "domain_descriptions", "one", "two", "three"]
            assert len(lines[1]) == len(lines[0])
            assert len(lines[2]) == len(lines[0])
            assert lines[1] == ["sp|P0AGD1|SODC_ECOLI", "131567; 2; 1224; 1236; 91347; 543; 561; 562", "cellular organisms; Bacteria; Pseudomonadota; Gammaproteobacteria; Enterobacterales; Enterobacteriaceae; Escherichia; Escherichia coli", "562", "2", "561", "Escherichia coli", "Bacteria", "Escherichia", "", "1", "2.0", "three"] 
            assert lines[2] == ["sp|O31851|YOJM_BACSU", "131567; 2; 1783272; 1239; 91061; 1385; 186817; 1386; 653685; 1423", "cellular organisms; Bacteria; Terrabacteria group; Bacillota; Bacilli; Bacillales; Bacillaceae; Bacillus; Bacillus subtilis group; Bacillus subtilis", "1423", "2", "1386", "Bacillus subtilis", "Bacteria", "Bacillus", "", "1", "2.0", "three"]

def test_enum_report_identity_1(shared_datadir):
    """
    Test that the identity column is correctly output
    """
    with tempfile.TemporaryDirectory() as output_dir:
        
        # output_dir = "test_out"
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "CuSOD_enum_report_test.gb"), "-o", out, '--identity', '--domain_search'])
        assert Path(out).is_file()
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 3
            for i, l in enumerate(lines):
                lines[i] = lines[i].rstrip("\r\n").split("\t")
            assert lines[0] == ["contig", "identity", "best_query", "query_description", "query_start", "query_end", "query_length", "match_start", "match_end", "match_strand", "match_score", "match_identity"]
            assert len(lines[1]) == len(lines[0])
            assert len(lines[2]) == len(lines[0])
            assert lines[1] == ["sp|P0AGD1|SODC_ECOLI","138.1","sp|P0AGD1|SODC_ECOLI","Superoxide dismutase [Cu-Zn] OS=Escherichia coli (strain K12) OX=562 GN=sodC PE=1 SV=1", "3","79","100", "1","173","+","375.2","100.0"]
            assert lines[2] == ["sp|O31851|YOJM_BACSU","137.4","sp|O31851|YOJM_BACSU","Superoxide dismutase-like protein YojM OS=Bacillus subtilis (strain 168) OX=1423 GN=yojM PE=1 SV=1", "3","79","100", "1","196","+","442.9","100.0"]


def test_enum_report_architecture_detailed_qualifier_1(shared_datadir):
    
    with tempfile.TemporaryDirectory() as output_dir:
        #output_dir = "test_out"
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "pDONR201_multi_genemark_domainator.gb"), "-o", out, "--sequence", "--length", "--architecture_detailed", "--cds_count", "--domain_count",  "--qualifier", "CDS", "gene_type", "--feature_count", "CDS" ])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 5
            assert lines[0].strip().split("\t") == ["contig","sequence","length", "architecture_detailed", "cds_count", "domain_count", "qualifier_CDS_gene_type", "CDS_count"]
            for l_num in range(1,len(lines)):
                l = lines[l_num]
                l = l.strip().split("\t")
                assert f"pDONR201_{l_num}" == l[0]
                assert l[3] == "no_domains; CcdB; CcdA; CAT/2-oxoacid_dh/Condensation/2-oxoacid_dh/Condensation; APH/TCAD9; no_domains"
                assert l[4] == "6"
                assert l[5] == "9"
                assert l[6] == "bacteria; bacteria; bacteria; bacteria; bacteria; bacteria"
                assert l[1] == "CTTTCCTGCGTTATCCCCTGATTCTGTGGATAACCGTATTACCGCTAGCCAGGAAGAGTTTGTAGAAACGCAAAAAGGCCATCCGTCAGGATGGCCTTCTGCTTAGTTTGATGCCTGGCAGTTTATGGCGGGCGTCCTGCCCGCCACCCTCCGGGCCGTTGCTTCACAACGTTCAAATCCGCTCCCGGCGGATTTGTCCTACTCAGGAGAGCGTTCACCGACAAACAACAGATAAAACGAAAGGCCCAGTCTTCCGACTGAGCCTTTCGTTTTATTTGATGCCTGGCAGTTCCCTACTCTCGCGTTAACGCTAGCATGGATCTCGGGCCCCAAATAATGATTTTATTTTGACTGATAGTGACCTGTTCGTTGCAACAAATTGATGAGCAATGCTTTTTTATAATGCCAAGTTTGTACAAAAAAGCAGAACGAGAAACGTAAAATGATATAAATATCAATATATTAAATTAGATTTTGCATAAAAAACAGACTACATAATACTGTAAAACACAACATATCCAGTCACTATGAATCAACTACTTAGATGGTATTAGTGACCTGTAGTCGACCGACAGCCTTCCAAATGTTCTTCGGGTGATGCTGCCAACTTAGTCGACCGACAGCCTTCCAAATGTTCTTCTCAAACGGAATCGTCGTATCCAGCCTACTCGCTATTGTCCTCAATGCCGTATTAAATCATAAAAAGAAATAAGAAAAAGAGGTGCGAGCCTCTTTTTTGTGTGACAAAATAAAAACATCTACCTATTCATATACGCTAGTGTCATAGTCCTGAAAATCATCTGCATCAAGAACAATTTCACAACTCTTATACTTTTCTCTTACAAGTCGTTCGGCTTCATCTGGATTTTCAGCCTCTATACTTACTAAACGTGATAAAGTTTCTGTAATTTCTACTGTATCGACCTGCAGACTGGCTGTGTATAAGGGAGCCTGACATTTATATTCCCCAGAACATCAGGTTAATGGCGTTTTTGATGTCATTTTCGCGGTGGCTGAGATCAGCCACTTCTTCCCCGATAACGGAGACCGGCACACTGGCCATATCGGTGGTCATCATGCGCCAGCTTTCATCCCCGATATGCACCACCGGGTAAAGTTCACGGGAGACTTTATCTGACAGCAGACGTGCACTGGCCAGGGGGATCACCATCCGTCGCCCGGGCGTGTCAATAATATCACTCTGTACATCCACAAACAGACGATAACGGCTCTCTCTTTTATAGGTGTAAACCTTAAACTGCATTTCACCAGTCCCTGTTCTCGTCAGCAAAAGAGCCGTTCATTTCAATAAACCGGGCGACCTCAGCCATCCCTTCCTGATTTTCCGCTTTCCAGCGTTCGGCACGCAGACGACGGGCTTCATTCTGCATGGTTGTGCTTACCAGACCGGAGATATTGACATCATATATGCCTTGAGCAACTGATAGCTGTCGCTGTCAACTGTCACTGTAATACGCTGCTTCATAGCACACCTCTTTTTGACATACTTCGGGTATACATATCAGTATATATTCTTATACCGCAAAAATCAGCGCGCAAATACGCATACTGTTATCTGGCTTTTAGTAAGCCGGATCCACGCGATTACGCCCCGCCCTGCCACTCATCGCAGTACTGTTGTAATTCATTAAGCATTCTGCCGACATGGAAGCCATCACAGACGGCATGATGAACCTGAATCGCCAGCGGCATCAGCACCTTGTCGCCTTGCGTATAATATTTGCCCATGGTGAAAACGGGGGCGAAGAAGTTGTCCATATTGGCCACGTTTAAATCAAAACTGGTGAAACTCACCCAGGGATTGGCTGAGACGAAAAACATATTCTCAATAAACCCTTTAGGGAAATAGGCCAGGTTTTCACCGTAACACGCCACATCTTGCGAATATATGTGTAGAAACTGCCGGAAATCGTCGTGGTATTCACTCCAGAGCGATGAAAACGTTTCAGTTTGCTCATGGAAAACGGTGTAACAAGGGTGAACACTATCCCATATCACCAGCTCACCGTCTTTCATTGCCATACGGAATTCCGGATGAGCATTCATCAGGCGGGCAAGAATGTGAATAAAGGCCGGATAAAACTTGTGCTTATTTTTCTTTACGGTCTTTAAAAAGGCCGTAATATCCAGCTGAACGGTCTGGTTATAGGTACATTGAGCAACTGACTGAAATGCCTCAAAATGTTCTTTACGATGCCATTGGGATATATCAACGGTGGTATATCCAGTGATTTTTTTCTCCATTTTAGCTTCCTTAGCTCCTGAAAATCTCGATAACTCAAAAAATACGCCCGGTAGTGATCTTATTTCATTATGGTGAAAGTTGGAACCTCTTACGTGCCGATCAACGTCTCATTTTCGCCAAAAGTTGGCCCAGGGCTTCCCGGTATCAACAGGGACACCAGGATTTATTTATTCTGCGAAGTGATCTTCCGTCACAGGTATTTATTCGGCGCAAAGTGCGTCGGGTGATGCTGCCAACTTAGTCGACTACAGGTCACTAATACCATCTAAGTAGTTGATTCATAGTGACTGGATATGTTGTGTTTTACAGTATTATGTAGTCTGTTTTTTATGCAAAATCTAATTTAATATATTGATATTTATATCATTTTACGTTTCTCGTTCAGCTTTCTTGTACAAAGTGGGCATTATAAGAAAGCATTGCTTATCAATTTGTTGCAACGAACAGGTCACTATCAGTCAAAATAAAATCATTATTTGCCATCCAGCTGCAGCTCTGGCCCGTGTCTCAAAATCTCTGATGTTACATTGCACAAGATAAAAATATATCATCATGAACAATAAAACTGTCTGCTTACATAAACAGTAATACAAGGGGTGTTATGAGCCATATTCAACGGGAAACGTCGAGGCCGCGATTAAATTCCAACATGGATGCTGATTTATATGGGTATAAATGGGCTCGCGATAATGTCGGGCAATCAGGTGCGACAATCTATCGCTTGTATGGGAAGCCCGATGCGCCAGAGTTGTTTCTGAAACATGGCAAAGGTAGCGTTGCCAATGATGTTACAGATGAGATGGTCAGACTAAACTGGCTGACGGAATTTATGCCTCTTCCGACCATCAAGCATTTTATCCGTACTCCTGATGATGCATGGTTACTCACCACTGCGATCCCCGGAAAAACAGCATTCCAGGTATTAGAAGAATATCCTGATTCAGGTGAAAATATTGTTGATGCGCTGGCAGTGTTCCTGCGCCGGTTGCATTCGATTCCTGTTTGTAATTGTCCTTTTAACAGCGATCGCGTATTTCGTCTCGCTCAGGCGCAATCACGAATGAATAACGGTTTGGTTGATGCGAGTGATTTTGATGACGAGCGTAATGGCTGGCCTGTTGAACAAGTCTGGAAAGAAATGCATAAACTTTTGCCATTCTCACCGGATTCAGTCGTCACTCATGGTGATTTCTCACTTGATAACCTTATTTTTGACGAGGGGAAATTAATAGGTTGTATTGATGTTGGACGAGTCGGAATCGCAGACCGATACCAGGATCTTGCCATCCTATGGAACTGCCTCGGTGAGTTTTCTCCTTCATTACAGAAACGGCTTTTTCAAAAATATGGTATTGATAATCCTGATATGAATAAATTGCAGTTTCATTTGATGCTCGATGAGTTTTTCTAATCAGAATTGGTTAATTGGTTGTAACACTGGCAGAGCATTACGCTGACTTGACGGGACGGCGCAAGCTCATGACCAAAATCCCTTAACGTGAGTTTTCGTTCCACTGAGCGTCAGACCCCGTAGAAAAGATCAAAGGATCTTCTTGAGATCCTTTTTTTCTGCGCGTAATCTGCTGCTTGCAAACAAAAAAACCACCGCTACCAGCGGTGGTTTGTTTGCCGGATCAAGAGCTACCAACTCTTTTTCCGAAGGTAACTGGCTTCAGCAGAGCGCAGATACCAAATACTGTCCTTCTAGTGTAGCCGTAGTTAGGCCACCACTTCAAGAACTCTGTAGCACCGCCTACATACCTCGCTCTGCTAATCCTGTTACCAGTGGCTGCTGCCAGTGGCGATAAGTCGTGTCTTACCGGGTTGGACTCAAGACGATAGTTACCGGATAAGGCGCAGCGGTCGGGCTGAACGGGGGGTTCGTGCACACAGCCCAGCTTGGAGCGAACGACCTACACCGAACTGAGATACCTACAGCGTGAGCTATGAGAAAGCGCCACGCTTCCCGAAGGGAGAAAGGCGGACAGGTATCCGGTAAGCGGCAGGGTCGGAACAGGAGAGCGCACGAGGGAGCTTCCAGGGGGAAACGCCTGGTATCTTTATAGTCCTGTCGGGTTTCGCCACCTCTGACTTGAGCGTCGATTTTTGTGATGCTCGTCAGGGGGGCGGAGCCTATGGAAAAACGCCAGCAACGCGGCCTTTTTACGGTTCCTGGCCTTTTGCTGGCCTTTTGCTCACATGTT"
                assert l[2] == "4470"
                assert l[7] == "6"
                assert len(l) == 8

def test_enum_report_database_1(shared_datadir):
    """
    Test that the identity column is correctly output
    """
    with tempfile.TemporaryDirectory() as output_dir:
        
        # output_dir = "test_out"
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "pDONR201_multi_genemark_domainator_multi_hmm_2.gb"), "-o", out, "--by", "domain", "--domains", "--databases", "pdonr_hmms_1"])
        assert Path(out).is_file()
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 9
            for i, l in enumerate(lines):
                lines[i] = lines[i].rstrip("\r\n").split("\t")
            assert lines[0] == ["contig", "cds", "domain", "domains"]
            assert lines[1] == ["pDONR201_1", "pDONR201_2", "CcdB", "CcdB"]
            assert lines[2] == ["pDONR201_1", "pDONR201_3", "CcdA", "CcdA"]
            assert lines[3] == ["pDONR201_2", "pDONR201_2", "CcdB", "CcdB"]
            assert lines[4] == ["pDONR201_2", "pDONR201_3", "CcdA", "CcdA"]
            assert lines[5] == ["pDONR201_3", "pDONR201_4", "CAT", "CAT"]
            assert lines[6] == ["pDONR201_3", "pDONR201_5", "APH", "APH"]
            assert lines[7] == ["pDONR201_4", "pDONR201_4", "CAT", "CAT"]
            assert lines[8] == ["pDONR201_4", "pDONR201_5", "APH", "APH"]

# def test_enum_report_complete_cds(shared_datadir): #TODO: probably deprecate that option
    
#     with tempfile.TemporaryDirectory() as output_dir:
#         #output_dir = "test_out"
#         out = output_dir + "/enum_report.tsv"
#         enum_report.main(["-i", str(shared_datadir / "pDONR201_multi_genemark_domainator.gb"), "-o", out, "--complete_cds"])
#         assert Path(out).is_file()
        
#         with open(out) as f:
#             lines = f.readlines()
#             assert len(lines) == 5
#             assert lines[0].strip().split("\t") == ["contig","complete_cds"]
#             for l_num in range(1,len(lines)):
#                 l = lines[l_num]
#                 l = l.strip().split("\t")
#                 assert f"pDONR201_{l_num}" == l[0]
#                 assert l[1] == "4"
#                 assert len(l) == 2


def test_enum_report_filename_contig_1(shared_datadir):
    """
    Test that the --filename option correctly tracks source filenames in contig mode
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "206.gb"), str(shared_datadir / "ccdb.gb"), 
                         "-o", out, "--filename", "--domains"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 3  # header + 2 contigs
            for i, l in enumerate(lines):
                lines[i] = lines[i].rstrip("\r\n").split("\t")
            
            assert lines[0] == ["contig", "filename", "domains"]
            assert lines[1][0] == "Staphylococcus_phage_phiSA12_-_NC_023573.1"
            assert lines[1][1] == str(shared_datadir / "206.gb")
            assert lines[1][2] == ""
            
            assert lines[2][0] == "pDONR201_1265:958rc"
            assert lines[2][1] == str(shared_datadir / "ccdb.gb")
            assert lines[2][2] == "CcdB"


def test_enum_report_filename_cds_1(shared_datadir):
    """
    Test that the --filename option correctly tracks source filenames in CDS mode
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "pDONR201_multi_genemark_domainator.gb"), 
                         str(shared_datadir / "simple_genpept.gb"),
                         "-o", out, "--filename", "--domains", "--by", "cds"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            # 4 contigs * 6 CDSs each = 24, plus 5 protein sequences = 29, plus header = 30
            assert len(lines) == 30
            for i, l in enumerate(lines):
                lines[i] = lines[i].rstrip("\r\n").split("\t")
            
            assert lines[0] == ["contig", "cds", "filename", "domains"]
            
            # Check first file records
            for i in range(1, 25):  # First 24 data lines are from pDONR201
                assert lines[i][2] == str(shared_datadir / "pDONR201_multi_genemark_domainator.gb")
            
            # Check second file records
            for i in range(25, 30):  # Last 5 data lines are from simple_genpept
                assert lines[i][2] == str(shared_datadir / "simple_genpept.gb")
            
            # Verify specific CDS entries
            assert lines[1][0] == "pDONR201_1"
            assert lines[1][1] == "pDONR201_1"
            assert lines[1][3] == ""
            
            assert lines[2][0] == "pDONR201_1"
            assert lines[2][1] == "pDONR201_2"
            assert lines[2][3] == "CcdB"


def test_enum_report_filename_domain_1(shared_datadir):
    """
    Test that the --filename option correctly tracks source filenames in domain mode
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "ccdb.gb"), str(shared_datadir / "simple_genpept.gb"),
                         "-o", out, "--filename", "--domains", "--by", "domain"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            # 1 domain from ccdb.gb + 9 domains from simple_genpept.gb + header = 11
            assert len(lines) == 11
            for i, l in enumerate(lines):
                lines[i] = lines[i].rstrip("\r\n").split("\t")
            
            assert lines[0] == ["contig", "cds", "domain", "filename", "domains"]
            
            # Check first file record
            assert lines[1][0] == "pDONR201_1265:958rc"
            assert lines[1][1] == "1264_-1_959"
            assert lines[1][2] == "CcdB"
            assert lines[1][3] == str(shared_datadir / "ccdb.gb")
            assert lines[1][4] == "CcdB"
            
            # Check second file records
            for i in range(2, 11):
                assert lines[i][3] == str(shared_datadir / "simple_genpept.gb")


def test_enum_report_filename_with_other_options_1(shared_datadir):
    """
    Test that --filename works correctly with other analysis options
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "206.gb"), str(shared_datadir / "ccdb.gb"),
                         "-o", out, "--filename", "--domains", "--length", "--definition", "--cds_count"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 3
            for i, l in enumerate(lines):
                lines[i] = lines[i].rstrip("\r\n").split("\t")
            
            assert lines[0] == ["contig", "filename", "domains", "length", "definition", "cds_count"]
            
            # Verify all columns are present and filename is in correct position
            assert len(lines[1]) == 6
            assert len(lines[2]) == 6
            assert lines[1][1] == str(shared_datadir / "206.gb")
            assert lines[2][1] == str(shared_datadir / "ccdb.gb")


def test_enum_report_no_filename_1(shared_datadir):
    """
    Test that without --filename option, no filename column appears and no heading column is added
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "206.gb"), str(shared_datadir / "ccdb.gb"),
                         "-o", out, "--domains"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 3
            for i, l in enumerate(lines):
                lines[i] = lines[i].rstrip("\r\n").split("\t")
            
            # Verify filename column is NOT present
            assert lines[0] == ["contig", "domains"]
            assert len(lines[1]) == 2
            assert len(lines[2]) == 2

def test_enum_report_config_file_1(shared_datadir):
    """
    Test that enum_report can read parameters from a config file using --config
    """
    import json
    
    with tempfile.TemporaryDirectory() as output_dir:
        # Create a config file with various parameters
        config_file = output_dir + "/config.yaml"
        out = output_dir + "/enum_report.tsv"
        
        # Note: arguments with action='append_const' and dest='output_cols' 
        # need to be specified using --flag syntax in command line
        # or as a list in the config file
        config_content = f"""input:
  - {str(shared_datadir / "pDONR201_multi_genemark_domainator.gb")}
output: {out}
"""
        
        with open(config_file, 'w') as f:
            f.write(config_content)
        
        # Run enum_report with config file and additional command-line args
        # The append_const arguments work better from command line
        enum_report.main(["--config", config_file, "--domains", "--sequence", "--length", "--topology"])
        
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 5
            assert lines[0].strip().split("\t") == ["contig","domains","sequence","length","topology"]
            for l_num in range(1,len(lines)):
                l = lines[l_num]
                l = l.strip().split("\t")
                assert f"pDONR201_{l_num}" == l[0]
                assert l[1] == "2-oxoacid_dh; APH; CAT; CcdA; CcdB; Condensation; TCAD9"
                assert l[3] == "4470"
                assert l[4] == "linear"
                assert len(l) == 5


def test_enum_report_starts_with_1(shared_datadir):
    """
    Test that --starts_with reports the first character of sequences
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "FeSOD_20.gb"), "-o", out, "--starts_with", "--length"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 21  # 1 header + 20 records
            assert lines[0].strip().split("\t") == ["contig", "starts_with", "length"]
            for l_num in range(1, len(lines)):
                l = lines[l_num].strip().split("\t")
                # All proteins should start with M (methionine)
                assert l[1] == "M"
                assert len(l) == 3


def test_enum_report_isoelectric_point_1(shared_datadir):
    """
    Test that --isoelectric_point reports isoelectric point for protein sequences
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "FeSOD_20.gb"), "-o", out, "--isoelectric_point", "--length"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 21  # 1 header + 20 records
            assert lines[0].strip().split("\t") == ["contig", "isoelectric_point", "length"]
            for l_num in range(1, len(lines)):
                l = lines[l_num].strip().split("\t")
                # pI should be a reasonable float (typically 3-12)
                pI = float(l[1])
                assert 3.0 <= pI <= 12.0
                assert len(l) == 3


def test_enum_report_net_charge_1(shared_datadir):
    """
    Test that --net_charge reports net charge at specified pH
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "FeSOD_20.gb"), "-o", out, "--net_charge", "7", "--length"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 21  # 1 header + 20 records
            assert lines[0].strip().split("\t") == ["contig", "net_charge_7", "length"]
            for l_num in range(1, len(lines)):
                l = lines[l_num].strip().split("\t")
                # Net charge should be a float (can be positive or negative)
                charge = float(l[1])
                assert -50 <= charge <= 50  # reasonable range
                assert len(l) == 3


def test_enum_report_net_charge_multiple_ph_1(shared_datadir):
    """
    Test that --net_charge can be called multiple times with different pH values
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "FeSOD_20.gb"), "-o", out, "--net_charge", "5.5", "--net_charge", "7", "--net_charge", "8.5"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 21  # 1 header + 20 records
            assert lines[0].strip().split("\t") == ["contig", "net_charge_5.5", "net_charge_7", "net_charge_8.5"]
            for l_num in range(1, len(lines)):
                l = lines[l_num].strip().split("\t")
                # Net charge at lower pH should be more positive than at higher pH
                charge_5_5 = float(l[1])
                charge_7 = float(l[2])
                charge_8_5 = float(l[3])
                assert charge_5_5 >= charge_7  # more protonated at lower pH
                assert charge_7 >= charge_8_5
                assert len(l) == 4


def test_enum_report_repeat_count_1(shared_datadir):
    """
    Test that --repeat_count reports character repeats of specified minimum length
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "FeSOD_20.gb"), "-o", out, "--repeat_count", "2", "--repeat_count", "3"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 21  # 1 header + 20 records
            assert lines[0].strip().split("\t") == ["contig", "repeat_count_2", "repeat_count_3"]
            for l_num in range(1, len(lines)):
                l = lines[l_num].strip().split("\t")
                count_2 = int(l[1])
                count_3 = int(l[2])
                # Repeats of length 2+ should be >= repeats of length 3+
                assert count_2 >= count_3
                assert count_2 >= 0
                assert count_3 >= 0
                assert len(l) == 3


def test_enum_report_motif_count_1(shared_datadir):
    """
    Test that --motif_count reports occurrences of PROSITE motifs
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        # Use a simple motif pattern: M-A (methionine followed by alanine)
        enum_report.main(["-i", str(shared_datadir / "FeSOD_20.gb"), "-o", out, "--motif_count", "M-A", "--length"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 21  # 1 header + 20 records
            assert lines[0].strip().split("\t") == ["contig", "motif_count_M_A", "length"]
            for l_num in range(1, len(lines)):
                l = lines[l_num].strip().split("\t")
                count = int(l[1])
                assert count >= 0
                assert len(l) == 3


def test_enum_report_motif_count_complex_1(shared_datadir):
    """
    Test that --motif_count works with complex PROSITE patterns
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        # Use a more complex motif pattern: [AG]-x-[DE] (A or G, any amino acid, D or E)
        enum_report.main(["-i", str(shared_datadir / "FeSOD_20.gb"), "-o", out, "--motif_count", "[AG]-x-[DE]"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 21  # 1 header + 20 records
            assert lines[0].strip().split("\t") == ["contig", "motif_count_AG_x_DE"]
            for l_num in range(1, len(lines)):
                l = lines[l_num].strip().split("\t")
                count = int(l[1])
                assert count >= 0  # Some matches expected with this general pattern
                assert len(l) == 2


def test_enum_report_combined_new_options_1(shared_datadir):
    """
    Test that all new options can be combined together
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "FeSOD_20.gb"), "-o", out, 
                         "--starts_with", "--isoelectric_point", "--net_charge", "7",
                         "--repeat_count", "2", "--motif_count", "M-A", "--length"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 21  # 1 header + 20 records
            expected_headers = ["contig", "starts_with", "isoelectric_point", "net_charge_7", 
                               "repeat_count_2", "motif_count_M_A", "length"]
            assert lines[0].strip().split("\t") == expected_headers
            for l_num in range(1, len(lines)):
                l = lines[l_num].strip().split("\t")
                assert len(l) == 7
                assert l[1] == "M"  # starts_with
                assert 3.0 <= float(l[2]) <= 12.0  # isoelectric_point
                assert -50 <= float(l[3]) <= 50  # net_charge
                assert int(l[4]) >= 0  # repeat_count
                assert int(l[5]) >= 0  # motif_count
                assert int(l[6]) > 0  # length


def test_enum_report_molecular_weight_protein_1(shared_datadir):
    """
    Test that --molecular_weight reports molecular weight for protein sequences
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "FeSOD_20.gb"), "-o", out, "--molecular_weight", "--length"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 21  # 1 header + 20 records
            assert lines[0].strip().split("\t") == ["contig", "molecular_weight", "length"]
            for l_num in range(1, len(lines)):
                l = lines[l_num].strip().split("\t")
                mw = float(l[1])
                length = int(l[2])
                # Typical protein: ~110 Da per amino acid
                # These are ~190-210 aa proteins, so expect ~20000-25000 Da
                assert 15000 <= mw <= 30000
                # Rough sanity check: MW should be roughly proportional to length
                assert mw / length > 100  # at least 100 Da per residue
                assert mw / length < 130  # at most 130 Da per residue
                assert len(l) == 3


def test_enum_report_molecular_weight_dna_1(shared_datadir):
    """
    Test that --molecular_weight reports molecular weight for DNA sequences
    """
    with tempfile.TemporaryDirectory() as output_dir:
        out = output_dir + "/enum_report.tsv"
        enum_report.main(["-i", str(shared_datadir / "pDONR201_multi_genemark_domainator.gb"), "-o", out, "--molecular_weight", "--length"])
        assert Path(out).is_file()
        
        with open(out) as f:
            lines = f.readlines()
            assert len(lines) == 5  # 1 header + 4 records
            assert lines[0].strip().split("\t") == ["contig", "molecular_weight", "length"]
            for l_num in range(1, len(lines)):
                l = lines[l_num].strip().split("\t")
                mw = float(l[1])
                length = int(l[2])
                # Typical DNA: ~330 Da per nucleotide (single-stranded with 5' phosphate)
                # pDONR201 is 4470 bp, so expect ~1.4 million Da
                assert mw > 1000000
                # Rough sanity check: MW should be roughly proportional to length
                assert mw / length > 250  # at least 250 Da per nucleotide
                assert mw / length < 400  # at most 400 Da per nucleotide
                assert len(l) == 3
